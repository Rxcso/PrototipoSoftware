@using WebApplication4.Models


@{
    ViewBag.Title = "ReporteAsignacion";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@model ReporteAsignacionModel


<div class="container-fluid">
    <div class="col-md-5">
        <ol class="breadcrumb">
            <li class="active">Generar Reporte de Asignacion de Vendedores</li>
        </ol>
    </div>
</div>

<div class="container">
 
    <div id="busqAvanzada" class="row" style="text-align:center">
       
            <!--formulario EN LINEA-->

         
        <div id="alerta" class="alert alert-warning" hidden></div>
            @using (Ajax.BeginForm("ObtenerAsignacion", "CuentaUsuario",null, new AjaxOptions
            {
                OnFailure = "validaciones",
                InsertionMode = InsertionMode.Replace,
                OnSuccess = "generarTabla",
                HttpMethod = "POST"

            }, new { id = "ReportForm", @class = "form-inline" }))
            {

                <div class="form-group ">
                    <div class="form-group ">
                        <div class="input-group">

                            <span class="input-group-addon">Desde:</span>
                            @Html.EditorFor(m => m.fechaInicio, new { })

                        </div>
                       
                    </div>
                    &nbsp;
                    <div class="form-group ">
                        <div class="input-group">
                            <span class="input-group-addon">Hasta:</span>
                            @Html.EditorFor(m => m.fechaFin, new { })

                        </div>
                       
                    </div>


                </div>

            }
       
    </div>
    <br />
    <div class="row">
        <div class="col-md-2">
            <a class="btn btn-primary" onclick="submitReport()">Generar <span class="glyphicon glyphicon-file"></span></a>
        </div>
        <div class="col-md-9">
            <a href="Reportes/ReporteAsignacion.xlsx" onclick="generarExcel()"    target="_blank" class="btn btn-primary "> Exportar a Excel </a>

        </div>
        <div class="col-md-1">
            <a class="btn btn-danger" href="index2.html">Salir <span class="glyphicon glyphicon-log-out"></span></a>
        </div>

    </div><br>

    <br>
    <br>
    <div class="row" align="center">
        <div id="my_result_table"><p></p></div>
    </div>

</div>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>

<script>

    $(document).ready(function () {


      
     


    });

    function generarTabla(data) {

        


        var fechI = document.getElementById("fechaInicio").value;
        var fechF = document.getElementById("fechaFin").value;
    

        t1 = "<h2> Reporte de Asignacion de Vendedores</h1>";
        t2 = "<h3>  Del: " + fechI + " al: "+ fechF +  "</h3>";
        myTable = t1 + t2 + "<table class='table table-bordered table-hover'>";
            myTable += "<tr><th>Fecha</th>";
            myTable += "<th>Punto de Venta</th><th>Vendedor</th><th>Hora</th>";


        $.each(data, function (k, v) {


            var date = new Date(parseInt(v.Dia.substr(6)));
            var fecha = date.getDate().toString() + "/" + (date.getMonth() + 1).toString() + "/" + date.getFullYear();

            myTable += "<tr><td> " + fecha + "</td>";
            myTable += "<td> " + v.PuntoVenta + "</td>";
            myTable += "<td>" + v.Nombre + "</td><td>" + v.Horas + "</td></tr>";




        });


        myTable += "</table>";
        document.getElementById("my_result_table").innerHTML = myTable;
      


    }

    function submitReport() {

        var valor = $("#alerta").children('strong');
        if (valor.length > 0) {

            valor.remove();

        }

        $("#alerta").hide();

        var fechI = $('#fechaInicio').val();
        var fechF = $('#fechaFin').val();

        if (fechF != '' && fechI != '') {


            

            if (new Date(fechF.replace(/(\d{4})-(\d{2})-(\d{2})/, "$2/$3/$1")) < new Date(fechI.replace(/(\d{4})-(\d{2})-(\d{2})/, "$2/$3/$1"))) {

                $("#alerta").append('<strong>Fecha hasta no puede ser menor que fecha desde</strong>').show();
                return;
            }


            

        }

        $("#ReportForm").submit();
    }

    function generarExcel() {

        window.open('data:application/vnd.ms-excel,' + encodeURIComponent($('div[id$=my_result_table]').html()));
        e.preventDefault();

    }
 
  


</script>
